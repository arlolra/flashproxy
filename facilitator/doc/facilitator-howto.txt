This document describes how to configure a flash proxy facilitator on Debian 7.
We will use the domain name fp-facilitator.example.com.

== Basic and security setup

Install some essential packages and configure a firewall.

	# cat >/etc/apt/apt.conf.d/90suggests<<EOF
APT::Install-Recommends "0";
APT::Install-Suggests "0";
EOF
	# apt-get remove portmap
	# apt-get update
	# apt-get upgrade
	# apt-get install shorewall shorewall6

Away from the facilitator, generate an SSH key for authentication:

	$ ssh-keygen -f ~/.ssh/fp-facilitator
	$ ssh-copy-id -i ~/.ssh/fp-facilitator.pub root@fp-facilitator.example.com

Then log in and edit /etc/ssh/sshd_config to disable password
authentication:

	PasswordAuthentication no

Configure the firewall to allow only SSH and HTTPS.

	# cd /etc/shorewall
	# cp /usr/share/doc/shorewall/examples/Universal/{interfaces,policy,rules,zones} .
	Edit /etc/shorewall/rules:
SECTION NEW
SSH(ACCEPT)	net	$FW
HTTPS(ACCEPT)	net	$FW

	# cd /etc/shorewall6
	# cp /usr/share/doc/shorewall6/examples/Universal/{interfaces,policy,rules,zones} .
	Edit /etc/shorewall6/rules:
SECTION NEW
SSH(ACCEPT)	all	$FW
HTTPS(ACCEPT)	all	$FW

Edit /etc/default/shorewall and /etc/default/shorewall6 and set

	startup=1

Restart servers.

	# /etc/init.d/ssh restart
	# /etc/init.d/shorewall start
	# /etc/init.d/shorewall6 start

== HTTP server setup

Apache is the web server that runs the CGI program.

	# apt-get install apache2 libapache2-mod-evasive
	# a2enmod ssl headers

Edit /etc/apache2/ports.conf and comment out the port 80 configuration.

	# NameVirtualHost *:80
	# Listen 80

Edit examples/fp-facilitator as per the instructions given in that file, and
install it to /etc/apache2/sites-available/fp-facilitator or whatever is
appropriate for your apache2 installation.

Link the configured site into sites-enabled.
	# a2ensite fp-facilitator

=== HTTPS setup

The HTTP server should serve only over HTTPS and not unencrypted HTTP.
You will need a certificate and private key from a certificate
authority. An article on making a certificate signing request and
getting it signed is here:
	http://www.debian-administration.org/articles/284
This is the basic command to generate a CSR.
	$ openssl req -new -nodes -out fp-facilitator.csr.pem
The instructions below assume you have an offline private key
in fp-facilitator.key.pem and a certificate in fp-facilitator.crt.pem.

Make a file containing both the private key and a certificate.

	$ cat fp-facilitator.key.pem fp-facilitator.crt.pem > fp-facilitator.pem
	$ chmod 400 fp-facilitator.pem

Copy the new fp-facilitator.pem to the facilitator server as
/etc/apache2/fp-facilitator.pem.

	# /etc/init.d/apache2 restart
